flowchart LR
  %% Frontend components
  subgraph Frontend
    direction LR
    Chat[Gradio Chat UI]
    Chart[Plotly Chart Pane]
  end

  %% Backend components
  subgraph Backend
    direction LR
    Server[Gradio Python Server]
    State[Session State Store]
    Prompt[Prompt Template Engine]
    GPT[OpenAI GPT-4 API]
    Renderer[Plotly Rendering Layer]
  end

  %% Interactions
  Chat -->|User message| Server
  Chart -->|Initial render| Server
  Server -->|Load/Save fig JSON| State
  Server -->|Build prompt| Prompt
  Prompt -->|Send prompt| GPT
  GPT -->|JSON patch| Server
  Server -->|Apply patch| Renderer
  Renderer -->|Updated fig| Chart
  Server -->|Render UI| Chat
  State -->|Persistence| Server